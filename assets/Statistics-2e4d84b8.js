import{bq as o,bt as n,bs as v,bE as w}from"./vendor-0e7efaec.js";import{t as l,u as R,G as D,T as _,B as C,a as A,I as F}from"./index-69b752cb.js";import{i as O}from"./echarts-92a9ada8.js";const N=u=>{const{className:f,items:t=[]}=u,d=o.useRef(null),i=o.useRef(!1),e=t.map(s=>s.x),r=t.map(s=>s.y),m=o.useRef();return o.useEffect(()=>{if(!d.current||i.current)return;m.current=O(d.current),i.current=!0;const s={tooltip:{trigger:"axis",formatter:([{axisValue:c,data:x}])=>{const h=c.split("-"),b=`${h[0]}年${h[1]}月${h[2]}日`,p=x===null?"无数据":`${x} 元`;return`${b}<br/><div style="text-align: right;">${p}</div>`}},grid:{left:16,right:16,top:8,bottom:20},xAxis:{type:"category",data:e,axisLabel:{formatter:c=>c.slice(c.indexOf("-")+1)}},yAxis:{type:"value",axisLabel:{show:!1}},series:[{data:r,type:"line"}]};m.current.setOption(s)},[]),o.useEffect(()=>{var c;const s={xAxis:{data:e},series:[{data:r}]};(c=m.current)==null||c.setOption(s)},[t]),n("div",{ref:d,className:f})},S=u=>{const{className:f,items:t}=u,d=o.useRef(null),i=o.useRef(!1),e=o.useRef();return o.useEffect(()=>{if(!d.current||i.current)return;e.current=O(d.current),i.current=!0;const r={tooltip:{trigger:"item",formatter:({data:{name:m,value:s}})=>`${m} ${s}元`},grid:{top:0,left:0,right:0,bottom:0},series:[{type:"pie",radius:[20,100],roseType:"area",itemStyle:{borderRadius:5},data:t}]};e.current.setOption(r)},[]),o.useEffect(()=>{const r={series:[{data:t}]};e.current&&e.current.setOption(r)},[t]),n("div",{className:f,ref:d,children:"PieChart"})},T=["#61cdbb","#ef8e24","#a2dcf3","#d73027","#f6eff7","#fee0d2","#f46d43","#a50026","#7f000d","#400004"],j=u=>{const{className:f,items:t}=u,d=(t==null?void 0:t.reduce((e,r)=>e+r.value,0))??0,i=(t==null?void 0:t.reduce((e,r)=>Math.max(e,r.value),0))??0;return n("div",{className:f,children:t?t==null?void 0:t.map((e,r)=>v("div",{grid:"","grid-cols":"[48px_1fr_1fr]","grid-rows":"[repeat(2,1fr)]","p-16px":"","gap-x-8px":"","gap-y-6px":"","items-center":"",children:[n("div",{"row-start-1":"","col-start-1":"","row-end-3":"","col-end-2":"","h-48px":"","w-48px":"","rounded-24px":"",flex:"","justify-center":"","items-center":"","text-24px":"",bg:"#EFEFEF",children:e.icon}),v("div",{"row-start-1":"","col-start-2":"","row-end-2":"","col-end-3":"","self-end":"",children:[e.name," - ",(e.value/d*100).toFixed(0),"%"]}),v("div",{"row-start-1":"","col-start-3":"","row-end-2":"","col-end-4":"","text-right":"","self-end":"",children:["￥",e.value,"元"]}),n("div",{"row-start-2":"","col-start-2":"","row-end-3":"","col-end-4":"","self-start":"","h-8px":"","rounded-4px":"",bg:"#EFEFEF",children:n("div",{style:{background:T[r],width:`${e.value/i*100}%`},"h-8px":"","rounded-4px":""})})]},r)):"暂无数据"})},z=()=>{const[u,f]=o.useState({name:"thisMonth",start:l().firstDayOfMonth,end:l().lastDayOfMonth.add(1,"day")}),[t,d]=o.useState("expenses"),{get:i}=R({showLoading:!1,handleError:!0}),e="yyyy-MM-dd",r=({start:a,end:y,kind:g,group_by:M})=>`/api/v1/items/summary?happen_after=${a.format(e)}&happen_before=${y.format(e)}&kind=${g}&group_by=${M}`,m=a=>Array.from({length:a.dayCountOfMonth}).map((y,g)=>({x:s.clone.add(g,"day").format(e),y:0})),{start:s,end:c}=u,x=m(s),{data:h}=w(r({start:s,end:c,kind:t,group_by:"happen_at"}),async a=>(await i(a)).data.groups.map(g=>({x:g.happen_at,y:g.amount/100}))),b=x==null?void 0:x.map(a=>(h==null?void 0:h.find(y=>y.x===a.x))??a),{data:p}=w(r({start:s,end:c,kind:t,group_by:"tag_id"}),async a=>(await i(a)).data.groups),E=(p==null?void 0:p.map(a=>({name:a.tag.name,value:a.amount/100})))??[],k=p==null?void 0:p.map(a=>({name:a.tag.name,value:a.amount/100,icon:a.tag.sign})),$=[{key:{name:"thisMonth",start:l().firstDayOfMonth,end:l().lastDayOfMonth.add(1,"day")},value:"本月"},{key:{name:"lastMonth",start:l().add(-1,"month").firstDayOfMonth,end:l().add(-1,"month").lastDayOfMonth.add(1,"day")},value:"上月"},{key:{name:"twoMonthsAgo",start:l().add(-2,"month").firstDayOfMonth,end:l().add(-2,"month").lastDayOfMonth.add(1,"day")},value:"两月前"},{key:{name:"threeMonthsAgo",start:l().add(-3,"month").firstDayOfMonth,end:l().add(-3,"month").lastDayOfMonth.add(1,"day")},value:"三月前"}];return v("div",{children:[n(D,{children:n(_,{title:"账目列表",icon:n(C,{})})}),n(A,{selected:u,onSelect:f,timeRanges:$}),v("div",{flex:"","items-center":"","px-16px":"","gap-x-16px":"","p-16px":"",children:[n("span",{"grow-0":"","shrink-0":"",children:"类型"}),n("div",{"grow-1":"","shrink-1":"",children:n(F,{type:"select",options:[{value:"19",text:"红色"},{value:"支出",text:"白色"}],value:t,disableError:!0,onChange:a=>d(a)})})]}),n(N,{className:"h-120px mt-10",items:b}),n(S,{className:"h-400px mt-10",items:E}),n(j,{className:"h-100px mt-10",items:k})]})};export{z as Statistics,z as default};
